<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ligaplaner – Turnier</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 2rem;
        background: #f4f6f9;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
        background: white;
      }
      th, td {
        border: 1px solid #ccc;
        padding: 0.5rem;
        text-align: center;
      }
      th { background-color: #003366; color: white; }
      .highlight { background-color: orange; }
      .result-input input { width: 40px; text-align: center; }
      .hidden { display: none; }
      #teamList input { margin: 2px; padding: 5px 10px; }
      /* Header & Navigation */
      #header { display: flex; align-items: center; justify-content: center; gap: 20px; }
      #logo { display: inline-block; vertical-align: middle; }
      #logo img { max-width: 200px; height: auto; }
      #header button { padding: 12px 24px; font-size: 1.2rem; cursor: pointer; }
      /* Hamburger-Menü und Sidebar */
      #hamburgerIcon {
        position: fixed; top: 10px; left: 20px;
        font-size: 30px; cursor: pointer; z-index: 999;
      }
      #sidebar {
        position: fixed; top: 0; left: -250px;
        width: 250px; height: 100%;
        background-color: #fff;
        box-shadow: 2px 0 5px rgba(0,0,0,0.3);
        padding: 10px; transition: left 0.3s ease; z-index: 1001;
      }
      #sidebar.open { left: 0; }
      #sidebar h2 { margin-top: 0; }
      #sidebar ul { list-style: none; padding: 0; }
      #sidebar li { padding: 8px; cursor: pointer; border-bottom: 1px solid #ccc; }
      #sidebar li:hover { background-color: #f0f0f0; }
      .group-tables { display: flex; justify-content: space-between; gap: 1rem; }
      #navigationControls { text-align: center; margin-bottom: 1rem; }
      /* Pfeiltasten größer */
      #navigationControls button {
        font-size: 1.5rem;
        padding: 0.5rem 1rem;
        margin: 0 0.5rem;
      }
    </style>
  </head>
  <body>
    <!-- Hamburger-Menü Icon -->
    <div id="hamburgerIcon" onclick="vToggleSidebar()">&#9776;</div>
    <!-- Sidebar -->
    <div id="sidebar">
      <span id="closeSidebar" onclick="vToggleSidebar()" style="cursor:pointer; float:right; font-size:30px;">&times;</span>
      <h2>Teams</h2>
      <ul id="sidebarList"></ul>
      <button id="clearFilterButtonSidebar" onclick="vClearFilter()">Filter zurücksetzen</button>
    </div>
    <!-- Header -->
    <div id="header">
      <div id="logo">
        <img src="Image.png" alt="Campusliga Logo" />
      </div>
      <div id="navigationButtons">
        <button onclick="location.href='volleyball.html'">Vorrunde</button>
        <button onclick="location.href='Hauptrunde.html'">Hauptrunde</button>
        <button onclick="location.href='Playoffs.html'">Playoffs</button>
      </div>
    </div>
    <h1 style="display:none;">Ligaplaner – Turnier</h1>
    <!-- Admin: Teams bearbeiten -->
    <div id="teamList" class="hidden"></div>
    <!-- Standings -->
    <div id="standingsContainer"></div>
    <!-- Navigation (Spieltage) -->
    <div id="navigationControls">
      <button onclick="vVorherigerSpieltag()">⬅️</button>
      <span id="spieltagLabel">Spieltag 1</span>
      <button onclick="vNaechsterSpieltag()">➡️</button>
    </div>
    <!-- Spieltagsansicht -->
    <div id="spieltagContainer"></div>
    <!-- Admin: PIN & Speichern -->
    <div style="margin-top:2rem; text-align:center;">
      <input type="password" id="adminPinInput" placeholder="Admin PIN" />
      <button onclick="vToggleAdmin()">Anmelden</button>
      <button id="saveButton" onclick="vSaveAllMatchdays()" style="display:none;">Speichern</button>
    </div>
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
      // Firebase-Konfiguration
      const vFirebaseConfig = {
        apiKey: "AIzaSyAsn...",
        authDomain: "uni-liga.firebaseapp.com",
        projectId: "uni-liga",
        storageBucket: "uni-liga.appspot.com",
        messagingSenderId: "196698710621",
        appId: "1:196698710621:web:66d13babfc997bab5a3b4"
      };
      firebase.initializeApp(vFirebaseConfig);
      const vDb = firebase.firestore();

      let vAdminMode = false;
      let vCurrentMatchday = 0;
      let vTeamMapping = {};

      // Hilfsfunktion: Deutsches Datumsformat (dd.mm.yyyy)
      function vFormatGermanDate(isoDate) {
        if (!isoDate) return "-";
        const parts = isoDate.split("-");
        if (parts.length < 3) return isoDate;
        return parts[2] + "." + parts[1] + "." + parts[0];
      }

      // Default-Teamnamen
      function vGenerateStandardTeams() {
        let tmp = {};
        for (let i = 1; i <= 8; i++) {
          tmp["A" + i] = "Team A" + i;
          tmp["B" + i] = "Team B" + i;
        }
        return tmp;
      }

      // Alle Spieltage mit Datum und Spielen
      const vMatchdays = [
        {
          nummer: 1,
          datum: "",
          spiele: [
            { zeit: "16:15 – 16:30", teamA: "A3", teamB: "A4", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:15 – 16:30", teamA: "A5", teamB: "A6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:35 – 16:50", teamA: "A3", teamB: "A5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:35 – 16:50", teamA: "A4", teamB: "A6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:55 – 17:10", teamA: "A1", teamB: "A2", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:55 – 17:10", teamA: "A7", teamB: "A8", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:15 – 17:30", teamA: "A1", teamB: "A3", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:15 – 17:30", teamA: "A7", teamB: "A5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:35 – 17:50", teamA: "A2", teamB: "A4", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:35 – 17:50", teamA: "A8", teamB: "A6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:55 – 18:10", teamA: "A4", teamB: "A1", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:55 – 18:10", teamA: "A6", teamB: "A7", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "18:15 – 18:30", teamA: "A3", teamB: "A2", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "18:15 – 18:30", teamA: "A8", teamB: "A5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" }
          ]
        },
        {
          nummer: 2,
          datum: "",
          spiele: [
            { zeit: "16:15 – 16:30", teamA: "B3", teamB: "B4", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:15 – 16:30", teamA: "B5", teamB: "B6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:35 – 16:50", teamA: "B3", teamB: "B5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:35 – 16:50", teamA: "B4", teamB: "B6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:55 – 17:10", teamA: "B1", teamB: "B2", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:55 – 17:10", teamA: "B7", teamB: "B8", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:15 – 17:30", teamA: "B1", teamB: "B3", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:15 – 17:30", teamA: "B7", teamB: "B5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:35 – 17:50", teamA: "B2", teamB: "B4", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:35 – 17:50", teamA: "B8", teamB: "B6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:55 – 18:10", teamA: "B4", teamB: "B1", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:55 – 18:10", teamA: "B6", teamB: "B7", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "18:15 – 18:30", teamA: "B3", teamB: "B2", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "18:15 – 18:30", teamA: "B8", teamB: "B5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" }
          ]
        },
        {
          nummer: 3,
          datum: "",
          spiele: [
            { zeit: "16:15 – 16:30", teamA: "A1", teamB: "A8", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:15 – 16:30", teamA: "A2", teamB: "A7", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:35 – 16:50", teamA: "A1", teamB: "A7", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:35 – 16:50", teamA: "A2", teamB: "A8", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:55 – 17:10", teamA: "A3", teamB: "A6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:55 – 17:10", teamA: "A4", teamB: "A5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:15 – 17:30", teamA: "A1", teamB: "A6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:15 – 17:30", teamA: "A2", teamB: "A5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:35 – 17:50", teamA: "A7", teamB: "A3", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:35 – 17:50", teamA: "A8", teamB: "A4", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:55 – 18:10", teamA: "A1", teamB: "A5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:55 – 18:10", teamA: "A2", teamB: "A6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "18:15 – 18:30", teamA: "A7", teamB: "A4", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "18:15 – 18:30", teamA: "A8", teamB: "A3", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" }
          ]
        },
        {
          nummer: 4,
          datum: "",
          spiele: [
            { zeit: "16:15 – 16:30", teamA: "B1", teamB: "B8", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:15 – 16:30", teamA: "B2", teamB: "B7", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:35 – 16:50", teamA: "B1", teamB: "B7", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:35 – 16:50", teamA: "B2", teamB: "B8", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:55 – 17:10", teamA: "B3", teamB: "B6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "16:55 – 17:10", teamA: "B4", teamB: "B5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:15 – 17:30", teamA: "B1", teamB: "B6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:15 – 17:30", teamA: "B2", teamB: "B5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:35 – 17:50", teamA: "B7", teamB: "B3", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:35 – 17:50", teamA: "B8", teamB: "B4", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:55 – 18:10", teamA: "B1", teamB: "B5", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "17:55 – 18:10", teamA: "B2", teamB: "B6", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "18:15 – 18:30", teamA: "B7", teamB: "B4", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" },
            { zeit: "18:15 – 18:30", teamA: "B8", teamB: "B3", goalsA: "", goalsB: "", feld: "Feld 1", schiedsrichter: "" }
          ]
        }
      ];

      // Speichern & Laden Team-Mapping
      function vSaveVTeamMapping() {
        vDb.collection("v_metadata").doc("v_team_mapping").set({ vTeamMapping })
          .then(() => console.log("V Team Mapping gespeichert"))
          .catch(error => console.error("Fehler beim Speichern des V Team Mappings:", error));
      }

      function vLoadVTeamMapping() {
        vDb.collection("v_metadata").doc("v_team_mapping").get()
          .then(doc => {
            if (doc.exists && doc.data().vTeamMapping) {
              vTeamMapping = doc.data().vTeamMapping;
            } else {
              vTeamMapping = vGenerateStandardTeams();
              vSaveVTeamMapping();
            }
            vRenderTeamList(); vRenderSidebarTeamList(); vRenderDefaultView();
          })
          .catch(error => {
            console.error("Fehler beim Laden des Team-Mappings:", error);
            vTeamMapping = vGenerateStandardTeams(); vSaveVTeamMapping();
            vRenderTeamList(); vRenderSidebarTeamList(); vRenderDefaultView();
          });
      }

      // Speichern & Laden Spieltage
      function vSaveAllMatchdays() {
        vDb.collection("v_metadata").doc("v_matchdays").set({ vMatchdays })
          .then(() => { alert("Alle Spieltage (inkl. Datum) gespeichert!"); vRenderStandings(); })
          .catch(error => console.error("Fehler beim Speichern der Spieltage:", error));
      }

      function vLoadAllMatchdays() {
        vDb.collection("v_metadata").doc("v_matchdays").get()
          .then(doc => {
            if (doc.exists && doc.data().vMatchdays) {
              vMatchdays.splice(0, vMatchdays.length, ...doc.data().vMatchdays);
            }
            vRenderStandings(); vRenderMatchday();
          })
          .catch(error => { console.error("Fehler beim Laden der v_matchdays:", error); vRenderStandings(); vRenderMatchday(); });
      }

      // Admin Anmeldung
      function vToggleAdmin() {
        const pin = document.getElementById("adminPinInput").value;
        if (pin === "3141") { vAdminMode = true; document.getElementById("saveButton").style.display = "inline-block"; }
        else { alert("Falscher PIN"); }
        vRenderTeamList(); vRenderSidebarTeamList(); vRenderDefaultView();
      }

      // Team-Liste rendern
      function vRenderTeamList() {
        const teamListDiv = document.getElementById("teamList");
        if (vAdminMode) {
          teamListDiv.classList.remove("hidden");
          let aDiv = document.createElement("div"); aDiv.style.display = "inline-block"; aDiv.style.verticalAlign = "top"; aDiv.style.marginRight = "30px";
          let bDiv = document.createElement("div"); bDiv.style.display = "inline-block"; bDiv.style.verticalAlign = "top";
          aDiv.innerHTML = "<h2>Teams Gruppe A</h2>";
          bDiv.innerHTML = "<h2>Teams Gruppe B</h2>";
          for (const teamID in vTeamMapping) {
            let container = document.createElement("div"); container.style.marginBottom = "5px";
            let html = `<label style=\"margin-right:10px;\">${teamID}:</label><input type=\"text\" value=\"${vTeamMapping[teamID]}\" onchange=\"vTeamMapping['${teamID}']=this.value;vSaveVTeamMapping();vRenderTeamList();vRenderSidebarTeamList();vRenderDefaultView()\" />`;
            if (teamID.startsWith("A")) aDiv.appendChild(container).innerHTML = html;
            else if (teamID.startsWith("B")) bDiv.appendChild(container).innerHTML = html;
          }
          teamListDiv.innerHTML = ""; teamListDiv.appendChild(aDiv); teamListDiv.appendChild(bDiv);
        } else {
          teamListDiv.classList.add("hidden");
        }
      }

      // Sidebar toggle
      function vToggleSidebar() {
        const sidebar = document.getElementById("sidebar"); sidebar.classList.toggle("open");
        document.getElementById("hamburgerIcon").style.display = sidebar.classList.contains("open") ? "none" : "block";
      }

      // Sidebar-Teamliste
      function vRenderSidebarTeamList() {
        const ul = document.getElementById("sidebarList"); ul.innerHTML = "";
        for (const teamID in vTeamMapping) {
          if (/^[AB]/.test(teamID)) {
            let li = document.createElement("li"); li.textContent = vTeamMapping[teamID]; li.style.cursor = "pointer";
            li.onclick = function() { Array.from(ul.children).forEach(i=>i.classList.remove("​highlight")); li.classList.add("highlight"); vRenderTeamSchedule(teamID); };
            ul.appendChild(li);
          }
        }
      }

      // Filter zurücksetzen
      function vClearFilter() {
        document.getElementById("sidebarList").querySelectorAll("li").forEach(i=>i.classList.remove("highlight"));
        document.getElementById("navigationControls").style.display = "block";
        vRenderDefaultView();
      }

      // Default-Ansicht
      function vRenderDefaultView() { vRenderStandings(); vRenderMatchday(); }

      // Gruppenstatistiken
      function vComputeGroupStats(prefix) {
        let stats = {};
        for (const t in vTeamMapping) if (t.startsWith(prefix)) stats[t]={games:0,wins:0,gf:0,ga:0};
        let idxs = prefix==='A'? [0,2]: [1,3];
        idxs.forEach(i=> {
          vMatchdays[i].spiele.forEach(m=> {
            let a=parseInt(m.goalsA,10), b=parseInt(m.goalsB,10);
            if(!isNaN(a)&& !isNaN(b)){
              if(m.teamA.startsWith(prefix)){ stats[m.teamA].games++; stats[m.teamA].gf+=a; stats[m.teamA].ga+=b; if(a>b) stats[m.teamA].wins++; }
              if(m.teamB.startsWith(prefix)){ stats[m.teamB].games++; stats[m.teamB].gf+=b; stats[m.teamB].ga+=a; if(b>a) stats[m.teamB].wins++; }
            }
          });
        });
        return Object.entries(stats).sort((a,b)=> b[1].wins - a[1].wins || (b[1].gf-b[1].ga)-(a[1].gf-a[1].ga));
      }

      // Tabelle erstellen
      function vCreateStandingsTable(data,label){
        let tbl=document.createElement("table"); let cap=document.createElement("caption"); cap.textContent=label; tbl.appendChild(cap);
        tbl.innerHTML+=`<thead><tr><th>Team</th><th>Spiele</th><th>Siege</th><th>Punkte</th></tr></thead>`;
        let bd=document.createElement("tbody"); data.forEach(([id,s])=>{ bd.innerHTML+=`<tr><td>${vTeamMapping[id]}</td><td>${s.games}</td><td>${s.wins}</td><td>${s.gf}:${s.ga}</td></tr>`; }); tbl.appendChild(bd);
        return tbl;
      }

      // Tabellen rendern
      function vRenderStandings(){
        let cont=document.getElementById("standingsContainer"); cont.innerHTML="";
        let a=vComputeGroupStats("A"), b=vComputeGroupStats("B");
        let wrap=document.createElement("div"); wrap.className="group-tables";
        wrap.appendChild(vCreateStandingsTable(a,"Gruppe A")); wrap.appendChild(vCreateStandingsTable(b,"Gruppe B"));
        cont.appendChild(wrap);
      }

      // Spieltagsansicht
      function vRenderMatchday(){
        let cont=document.getElementById("spieltagContainer"); cont.innerHTML="";
        let md=vMatchdays[vCurrentMatchday];
        let dv=document.createElement("div");
        if(vAdminMode) dv.innerHTML=`Datum: <input type="date" value="${md.datum}" onchange="vUpdateDatum(${vCurrentMatchday},this.value)">`;
        else dv.textContent="Datum: "+vFormatGermanDate(md.datum);
        cont.appendChild(dv);
        let t=document.createElement("table"); let cap=document.createElement("caption"); cap.textContent="Spieltag "+md.nummer; t.appendChild(cap);
        t.innerHTML+=`<thead><tr><th>Feld</th><th>Zeit</th><th>Team A</th><th>Team B</th><th>Ergebnis</th><th>Schiedsrichter</th></tr></thead>`;
        let bd=document.createElement("tbody");
        md.spiele.forEach((m,i)=>{
          let row=document.createElement("tr");
          let feld=vAdminMode? `<select onchange="vUpdateGame(${vCurrentMatchday},${i},'feld',this.value)"><option value="Feld 1"${m.feld==='Feld 1'?' selected':''}>Feld 1</option><option value="Feld 2"${m.feld==='Feld 2'?' selected':''}>Feld 2</option></select>`: m.feld||'Feld 1';
          let aName=vTeamMapping[m.teamA]||m.teamA;
          let bName=vTeamMapping[m.teamB]||m.teamB;
          let erg="-";
          if(vAdminMode) erg=`<div class="result-input"><input type=number min=0 value="${m.goalsA}" onchange="vUpdateGame(${vCurrentMatchday},${i},'goalsA',this.value)"><span>:</span><input type=number min=0 value="${m.goalsB}" onchange="vUpdateGame(${vCurrentMatchday},${i},'goalsB',this.value)"></div>`;
          else if(m.goalsA!==""&&m.goalsB!="") erg=`${m.goalsA} : ${m.goalsB}`;
          let sch="";
          if(vAdminMode){
            let opts='<option value="">-- wählen --</option>';
            for(const k in vTeamMapping) if(/^[AB]/.test(k)) opts+=`<option value="${k}"${m.schiedsrichter===k?' selected':''}>${vTeamMapping[k]}</option>`;
            sch=`<select onchange="vUpdateGame(${vCurrentMatchday},${i},'schiedsrichter',this.value)">${opts}</select>`;
          } else sch=m.schiedsrichter? vTeamMapping[m.schiedsrichter]:'';
          row.innerHTML=`<td>${feld}</td><td>${m.zeit}</td><td>${aName}</td><td>${bName}</td><td>${erg}</td><td>${sch}</td>`;
          bd.appendChild(row);
        }); t.appendChild(bd); cont.appendChild(t);
      }

      function vUpdateDatum(md,i){ vMatchdays[md].datum=i; }
      function vUpdateGame(md,mi,f,v){ vMatchdays[md].spiele[mi][f]=v; }
      function vVorherigerSpieltag(){ if(vCurrentMatchday>0){ vCurrentMatchday--; document.getElementById("spieltagLabel").textContent="Spieltag "+vMatchdays[vCurrentMatchday].nummer; vRenderMatchday(); }}
      function vNaechsterSpieltag(){ if(vCurrentMatchday<vMatchdays.length-1){ vCurrentMatchday++; document.getElementById("spieltagLabel").textContent="Spieltag "+vMatchdays[vCurrentMatchday].nummer; vRenderMatchday(); }}

      // Einzelschedule eines Teams
      function vRenderTeamSchedule(teamID){
        document.getElementById("navigationControls").style.display="none";
        document.querySelectorAll("#standingsContainer td").forEach(td=>{ td.style.backgroundColor=td.innerText===vTeamMapping[teamID]? 'orange':''; });
        let cont=document.getElementById("spieltagContainer"); cont.innerHTML="";
        let hdr=document.createElement("h2"); hdr.textContent="Spiele von "+vTeamMapping[teamID]; cont.appendChild(hdr);
        let matches=[];
        vMatchdays.forEach(tag=> tag.spiele.forEach(m=>{ if(m.teamA===teamID||m.teamB===teamID) matches.push(Object.assign({spieltag:tag.nummer},m)); }));
        if(matches.length===0){ let p=document.createElement("p"); p.textContent="Keine Spiele gefunden."; cont.appendChild(p); return; }
        let tbl=document.createElement("table"); tbl.innerHTML=`<thead><tr><th>Spieltag</th><th>Zeit</th><th>Team A</th><th>Team B</th><th>Ergebnis</th><th>Feld</th><th>Schiedsrichter</th></tr></thead>`;
        let bd=document.createElement("tbody"); matches.forEach(m=>{ bd.innerHTML+=`<tr><td>${m.spieltag}</td><td>${m.zeit}</td><td>${vTeamMapping[m.teamA]||m.teamA}</td><td>${vTeamMapping[m.teamB]||m.teamB}</td><td>${m.goalsA&&m.goalsB?m.goalsA+" : "+m.goalsB:'-'}</td><td>${m.feld||'Feld 1'}</td><td>${m.schiedsrichter? vTeamMapping[m.schiedsrichter]:''}</td></tr>`; }); tbl.appendChild(bd); cont.appendChild(tbl);
      }

      // Init
      vLoadVTeamMapping();
      vLoadAllMatchdays();
    </script>
  </body>
</html>